<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01//EN" "http://www.w3.org/TR/html4/strict.dtd">
<html>
<head>
<meta http-equiv="content-type" content="text/html; charset=utf-8">
<title>Buffering</title>
<link rel="stylesheet" type="text/css" media="all" charset="utf-8" href="pythonanywhere/css/common.css">
<link rel="stylesheet" type="text/css" media="screen" charset="utf-8" href="pythonanywhere/css/screen.css">
<link rel="stylesheet" type="text/css" media="print" charset="utf-8" href="pythonanywhere/css/print.css">
<style type="text/css">
ul.pagetitle{
  display: inline;
  margin: 0;
  padding: 0;
  font-size: 1.5em;
}
li.pagetitle{
  display: inline;
  margin: 0;
}
td.noborder {
  border: 0;
}
</style>
</head>
<body>
<table>
<tr>
<td class="noborder">
<img src="logo.png">
</td>
<td class="noborder">
<ul class="pagetitle">
<li class="pagetitle"><a class="backlink">Buffering</a>
</ul>
<br><br>
[<a href="PythonAnywhereWiki.html">PythonAnywhereWiki</a>]&nbsp;[<a href="TitleIndex.html">TitleIndex</a>]&nbsp;[<a href="WordIndex.html">WordIndex</a>]&nbsp;
</td>
</tr>
</table>
<hr>
<div id="page">
<div dir="ltr" id="content" lang="en"><span class="anchor" id="top"></span>
<span class="anchor" id="line-1"></span><p class="line874">Some background knowledge: <span class="anchor" id="line-2"></span><span class="anchor" id="line-3"></span><p class="line862">When a request is sent from your browser to your webapp on <a href="./PythonAnywhere.html">PythonAnywhere</a>, it actually goes to a loadbalancer, which receives and processes your request using a nginx reverse proxy, which figures out and forwards the request along to one of the servers that your webapp(s) is running on. <span class="anchor" id="line-4"></span><span class="anchor" id="line-5"></span><p class="line862">That server receives and processes the request using its own nginx reverse proxy and passes it to uWSGI. Within uWSGI, since there are multiple webapps, there is the uWSGI emperor which passes the request over to the uWSGI vassal,  which then gives it to one of many worker, which is running a special <a href="./PythonAnywhere.html">PythonAnywhere</a> wrapper subprocess. <span class="anchor" id="line-6"></span><span class="anchor" id="line-7"></span><p class="line874">This is where we do stuff like try to catch errors for you that say setting django or flask debug=True still cannot catch, put it nicely into your error log, and show you an error page that tells you to go read your logs etc. Only then does it get to your actual code.  <span class="anchor" id="line-8"></span><span class="anchor" id="line-9"></span><p class="line867"><strong>tl;dr: your traffic goes through some jumps behind the scene and nginx buffers the response unless specified otherwise.</strong> <span class="anchor" id="line-10"></span><span class="anchor" id="line-11"></span><p class="line874">To get everything to flush,  <span class="anchor" id="line-12"></span><span class="anchor" id="line-13"></span><p class="line862">1. give your responses headers <tt>headers['X-Accel-Buffering']&nbsp;=&nbsp;'no'</tt> <span class="anchor" id="line-14"></span><span class="anchor" id="line-15"></span><p class="line862">2. have a <tt>'\n'</tt> at the end of the string you are yielding because python also buffers till end of line. <span class="anchor" id="line-16"></span><span class="anchor" id="bottom"></span></div>
</div>
<hr>
2015-08-21 13:55
</body>
</html>
